<div class="container mx-auto px-4 py-8">
  <!-- Header -->
    <div class="mb-10 text-center">
    <h1 class="text-4xl font-extrabold text-gray-800 tracking-tight mb-2">
        All Doctors
    </h1>

    <p class="text-lg text-gray-600">
        Find and connect with trusted healthcare professionals
    </p>
    </div>
    
  <!-- Search & Filter Section -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-10 border border-gray-100">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
        <h2 class="text-2xl font-semibold text-gray-800">Search & Filter</h2>
    </div>

    <!-- Filters Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">

        <!-- Search by Name -->
        <div class="lg:col-span-2">
        <label class="block text-sm font-semibold text-gray-700 mb-2">Search Doctor</label>

        <div class="relative">
            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>

            <input
            type="text"
            [(ngModel)]="searchName"
            (ngModelChange)="onSearchNameChange()"
            placeholder="Type doctor name..."
            class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition bg-gray-50 hover:bg-white"
            />
        </div>
        </div>

        <!-- Specialty Filter -->
        <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Specialty</label>
        <select
            [(ngModel)]="searchSpecialty"
            (ngModelChange)="applyFilters()"
            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition bg-gray-50 hover:bg-white"
        >
            <option value="">All Specialties</option>
            <option *ngFor="let specialty of specialties" [value]="specialty">{{ specialty }}</option>
        </select>
        </div>

        <!-- Gender Filter -->
        <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Gender</label>
        <select
            [(ngModel)]="searchGender"
            (ngModelChange)="applyFilters()"
            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition bg-gray-50 hover:bg-white"
        >
            <option value="">All Genders</option>
            <option *ngFor="let gender of genders" [value]="gender">{{ gender }}</option>
        </select>
        </div>

        <!-- Online Availability Filter -->
        <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Online Status</label>
        <select
            [(ngModel)]="searchOnlineStatus"
            (ngModelChange)="applyFilters()"
            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition bg-gray-50 hover:bg-white"
        >
            <option *ngFor="let status of onlineStatuses" [value]="status.value">
            {{ status.label }}
            </option>
        </select>
        </div>

    </div>

    <!-- Footer: Clear Filters + Results Count -->
    <div class="mt-6 flex flex-col md:flex-row items-center justify-between gap-4">
        <button
        (click)="clearFilters()"
        class="px-5 py-2.5 text-sm font-semibold text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 rounded-lg transition"
        >
        Clear All Filters
        </button>

        <p class="text-sm text-gray-600">
        Showing <span class="font-semibold text-gray-800">{{ showingFrom }}</span> -
        <span class="font-semibold text-gray-800">{{ showingTo }}</span> of
        <span class="font-semibold text-gray-800">{{ totalDoctors }}</span> doctors
        </p>
    </div>
    </div>


  <!-- Error Message -->
  <div *ngIf="error" class="text-red-600 text-center mb-4 bg-red-50 p-4 rounded-lg">
    {{ error }}
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="flex justify-center my-12">
    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500 border-b-4"></div>
  </div>

  <!-- Doctors Grid - Now using doctors directly from API -->
  <div *ngIf="!loading && doctors.length > 0" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-8">
    <div *ngFor="let doctor of doctors" class="bg-white shadow-lg rounded-2xl p-6 hover:shadow-2xl transform hover:-translate-y-1 transition duration-300 flex flex-col items-center text-center">
      
      <!-- Doctor Image or Initial -->
      <div class="w-32 h-32 mb-4 flex items-center justify-center rounded-full bg-blue-100 text-blue-600 text-3xl font-bold overflow-hidden">
        <img 
          *ngIf="getDoctorImage(doctor)" 
          [src]="getDoctorImage(doctor)" 
          [alt]="doctor.user.name || 'Doctor'" 
          class="w-full h-full object-cover rounded-full" 
          (error)="$any($event.target).src=''"
        />
        <span *ngIf="!getDoctorImage(doctor)">
          {{ getDoctorInitial(doctor) }}
        </span>
      </div>

      <!-- Doctor Name -->
      <h3 class="text-lg sm:text-xl font-semibold text-gray-800 mb-2">
        Dr. {{ doctor.user.name || 'Unknown' }}
      </h3>
      
      <!-- Specialty -->
      <p class="text-sm text-blue-600 font-medium mb-3">
        {{ doctor.specialty?.name || 'General Practice' }}
      </p>

      <!-- Bio -->
      <!-- <p *ngIf="doctor.bio" class="text-xs text-gray-600 mb-3 line-clamp-2">{{ doctor.bio }}</p> -->

      <!-- Details -->
      <div class="w-full text-left space-y-1 mb-4">
        <p class="text-sm text-gray-500">
          <strong>Education:</strong> {{ doctor.education || 'N/A' }}
        </p>
        <p class="text-sm text-gray-500">
          <strong>Experience:</strong> {{ doctor.years_experience }} years
        </p>
        <!-- <p class="text-sm text-gray-500">
          <strong>Gender:</strong> {{ doctor.gender }}
        </p> -->
        <p class="text-sm text-gray-500">
          <strong>Fee:</strong> ${{ doctor.consultation_fee }}
        </p>
        <p class="text-sm text-gray-500">
          <strong>Rating:</strong> {{ doctor.rating_avg || doctor.rating || 0 }} ‚≠ê
          <span *ngIf="doctor.reviews_count" class="text-xs">({{ doctor.reviews_count }} reviews)</span>
        </p>
        <p class="text-sm text-gray-500">
          <strong>Online:</strong> 
          <span [class]="doctor.available_for_online ? 'text-green-600' : 'text-red-600'">
            {{ doctor.available_for_online ? 'Available' : 'Not Available' }}
          </span>
        </p>
      </div>

      <!-- View Profile Button -->
      <a 
        [routerLink]="['/doctor', doctor.id]" 
        class="w-full bg-blue-500 text-white py-2 rounded-xl hover:bg-blue-600 transition text-center block"
      >
        View Profile
      </a>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && doctors.length === 0" class="text-center py-12">
    <svg class="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <p class="text-xl text-gray-600">No doctors found</p>
    <p class="text-gray-500 mt-2">Try adjusting your filters</p>
  </div>

  <!-- Pagination - Shows when totalPages > 1 -->
  <div *ngIf="!loading && totalPages > 1" class="flex flex-col items-center space-y-4 mt-8">
    
    <!-- Pagination Controls -->
    <div class="flex justify-center items-center space-x-2">
      <!-- Previous Button -->
      <button
        (click)="onPageChange(currentPage - 1)"
        [disabled]="currentPage === 1"
        [class.opacity-50]="currentPage === 1"
        [class.cursor-not-allowed]="currentPage === 1"
        class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition disabled:hover:bg-white flex items-center gap-2"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Previous
      </button>

      <!-- Page Numbers -->
      <button
        *ngFor="let page of getPageNumbers()"
        (click)="page !== -1 && onPageChange(page)"
        [class.bg-blue-500]="page === currentPage"
        [class.text-white]="page === currentPage"
        [class.bg-white]="page !== currentPage && page !== -1"
        [class.cursor-default]="page === -1"
        class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition min-w-[40px]"
        [class.hover:bg-blue-600]="page === currentPage"
        [disabled]="page === -1"
      >
        {{ page === -1 ? '...' : page }}
      </button>

      <!-- Next Button -->
      <button
        (click)="onPageChange(currentPage + 1)"
        [disabled]="currentPage === totalPages"
        [class.opacity-50]="currentPage === totalPages"
        [class.cursor-not-allowed]="currentPage === totalPages"
        class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition disabled:hover:bg-white flex items-center gap-2"
      >
        Next
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>

    <!-- Page Info -->
    <div class="text-sm text-gray-600">
      Page {{ currentPage }} of {{ totalPages }}
    </div>
  </div>
</div>