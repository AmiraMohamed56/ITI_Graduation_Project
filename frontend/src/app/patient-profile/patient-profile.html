<div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 md:p-8">
  <!-- Skeleton Loader -->
  <div *ngIf="loading" class="space-y-6 animate-pulse">
    <div class="h-40 bg-gray-200 rounded-3xl"></div>
    <div class="flex flex-col md:flex-row gap-6">
      <div class="flex-1 space-y-4">
        <div class="h-10 bg-gray-200 rounded-lg w-3/4"></div>
        <div class="h-6 bg-gray-200 rounded-lg w-1/2"></div>
        <div class="h-6 bg-gray-200 rounded-lg w-1/4"></div>
      </div>
      <div class="flex-1 space-y-4">
        <div class="h-10 bg-gray-200 rounded-lg w-full"></div>
        <div class="h-6 bg-gray-200 rounded-lg w-5/6"></div>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div *ngIf="!loading" class="max-w-7xl mx-auto space-y-6">
    <!-- Tabs -->
    <div class="flex border-b-2 border-gray-200 mb-4 overflow-x-auto">
      <button
        (click)="activeTab = 'profile'"
        [ngClass]="activeTab === 'profile' ? 'border-blue-500 text-blue-600' : 'text-gray-500'"
        class="pb-2 px-4 font-semibold transition-colors whitespace-nowrap"
      >
        Profile
      </button>
      <button
        (click)="activeTab = 'history'"
        [ngClass]="activeTab === 'history' ? 'border-blue-500 text-blue-600' : 'text-gray-500'"
        class="pb-2 px-4 font-semibold transition-colors whitespace-nowrap"
      >
        Medical History
      </button>
      <button
        (click)="activeTab = 'appointments'"
        [ngClass]="activeTab === 'appointments' ? 'border-blue-500 text-blue-600' : 'text-gray-500'"
        class="pb-2 px-4 font-semibold transition-colors whitespace-nowrap"
      >
        Appointments
      </button>
    </div>

    <!-- Profile Tab -->
    <div *ngIf="activeTab === 'profile'" class="space-y-10">
      <!-- Stats Section -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Card -->
        <div
          class="bg-white/10 backdrop-blur-2xl border border-white/20 rounded-2xl shadow-[0_8px_25px_rgba(0,0,0,0.12)] p-6 text-center hover:-translate-y-2 hover:shadow-blue-200/40 duration-300"
        >
          <p class="text-gray-500">Total Appointments</p>
          <h3 class="text-3xl font-bold text-blue-600">{{ patient.appointments_count }}</h3>
        </div>

        <div
          class="bg-white/10 backdrop-blur-2xl border border-white/20 rounded-2xl shadow-[0_8px_25px_rgba(0,0,0,0.12)] p-6 text-center hover:-translate-y-2 hover:shadow-indigo-200/40 duration-300"
        >
          <p class="text-gray-500">Medical Records</p>
          <h3 class="text-3xl font-bold text-indigo-600">{{ patient.medical_records_count }}</h3>
        </div>

        <div
          class="bg-white/10 backdrop-blur-2xl border border-white/20 rounded-2xl shadow-[0_8px_25px_rgba(0,0,0,0.12)] p-6 text-center hover:-translate-y-2 hover:shadow-purple-200/40 duration-300"
        >
          <p class="text-gray-500">Blood Type</p>
          <h3 class="text-3xl font-bold text-purple-600">{{ patient.blood_type }}</h3>
        </div>

        <div
          *ngIf="patient.age"
          class="bg-white/10 backdrop-blur-2xl border border-white/20 rounded-2xl shadow-[0_8px_25px_rgba(0,0,0,0.12)] p-6 text-center hover:-translate-y-2 hover:shadow-green-200/40 duration-300"
        >
          <p class="text-gray-500">Age</p>
          <h3 class="text-3xl font-bold text-green-600">{{ patient.age }}</h3>
        </div>
      </div>
      <!-- Header Card -->
      <div
        class="relative bg-white/10 backdrop-blur-2xl rounded-3xl border border-white/20 shadow-[0_8px_30px_rgb(0,0,0,0.12)] p-10 flex flex-col md:flex-row items-center gap-10 transition-all duration-500 hover:shadow-blue-300/40 hover:-translate-y-2"
      >
        <!-- Avatar -->
        <div class="relative group">
          <div
            *ngIf="patient.profile_pic; else initials"
            class="w-40 h-40 md:w-48 md:h-48 rounded-full overflow-hidden border-4 border-white/30 shadow-xl group-hover:scale-105 transition-transform duration-300"
          >
            <img [src]="patient.profile_pic" class="w-full h-full object-cover" />
          </div>

          <!-- Initials Avatar -->
          <ng-template #initials>
            <div
              class="w-40 h-40 md:w-48 md:h-48 rounded-full bg-gradient-to-br from-blue-500 to-indigo-700 flex items-center justify-center text-white text-5xl font-extrabold shadow-xl group-hover:scale-105 transition-transform duration-300"
            >
              {{ getInitials() }}
            </div>
          </ng-template>

          <!-- Online Indicator -->
          <div
            class="absolute bottom-3 right-3 w-6 h-6 bg-green-500 rounded-full border-4 border-white shadow-md"
          ></div>
        </div>

        <!-- Profile Info -->
        <div class="flex-1 text-center md:text-left space-y-2">
          <h1
            class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 tracking-wide"
          >
            {{ patient.name }}
          </h1>

          <div class="mt-3 space-y-1 text-gray-700 text-lg">
            <p class="flex items-center gap-2 justify-center md:justify-start">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.8"
                stroke="#2563eb"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M21.75 6.75v10.5A2.25 2.25 0 0119.5 19.5h-15A2.25 2.25 0 012.25 17.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.02 1.89l-7.5 4.875a2.25 2.25 0 01-2.46 0L3.27 8.883a2.25 2.25 0 01-1.02-1.89V6.75"
                />
              </svg>

              {{ patient.email }}
            </p>

            <p class="flex items-center gap-2 justify-center md:justify-start">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.8"
                stroke="#2563eb"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M2.25 4.5l4.5-.75a2.25 2.25 0 012.115 1.094l1.732 2.878a2.25 2.25 0 01-.383 2.71L8.25 12.75a12.058 12.058 0 005.005 5.006l2.318-1.964a2.25 2.25 0 012.71-.383l2.878 1.732A2.25 2.25 0 0120.25 21l-.75 4.5a2.25 2.25 0 01-2.25 2.25h-3A16.5 16.5 0 013 9.75v-3A2.25 2.25 0 014.5 4.5h3z"
                />
              </svg>

              {{ patient.phone }}
            </p>

            <p class="flex items-center gap-2 justify-center md:justify-start">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.8"
                stroke="#2563eb"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M6.75 3v2.25M17.25 3v2.25M3.75 9h16.5M4.5 7.5h15a2.25 2.25 0 012.25 2.25v9a2.25 2.25 0 01-2.25 2.25h-15A2.25 2.25 0 012.25 18.75v-9A2.25 2.25 0 014.5 7.5z"
                />
              </svg>

              Member since: {{ patient.member_since }}
            </p>

            <p
              class="flex items-center gap-2 justify-center md:justify-start"
              *ngIf="patient.chronic_diseases"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.8"
                stroke="#dc2626"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M12 8.25v7.5M8.25 12h7.5M12 2.25a9.75 9.75 0 110 19.5 9.75 9.75 0 010-19.5z"
                />
              </svg>
              chronic diseases:
              {{ patient.chronic_diseases }}
            </p>

            <p class="flex items-center gap-2 justify-center md:justify-start">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M9 12l2 2 4-4m7 2a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>

              <span>{{ patient.status }}</span> Status:
              <span class="capitalize font-semibold text-indigo-600">{{ patient.status }}</span>
            </p>
          </div>
        </div>

        <!-- Edit Button -->
        <button
          (click)="openEditModal()"
          class="absolute top-6 right-6 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-5 py-2 rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300 font-semibold flex items-center gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="white"
            class="w-4 h-4"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M16.862 3.487a2.25 2.25 0 013.182 3.182L7.063 19.65l-4.32 1.138 1.138-4.32L16.862 3.487z"
            />
          </svg>

          Edit
        </button>
      </div>
    </div>

    <!-- Medical History Tab -->
<div *ngIf="activeTab === 'history'" class="space-y-4">

  <!-- No Data Message -->
  <p *ngIf="pagedRecords.length === 0" class="text-center text-gray-500">
    No medical history records found.
  </p>

  <!-- Records List -->
  <div
    *ngFor="let record of pagedRecords; let i = index"
    class="bg-white/90 backdrop-blur-xl rounded-3xl shadow-lg p-6 transform transition-all duration-500 hover:-translate-y-2 hover:shadow-2xl opacity-0 animate-fade-in"
    [style.animationDelay]="i * 100 + 'ms'"
  >
    <h3 class="text-lg font-bold text-blue-600 mb-2">
      Medical Record #{{ record.id }}
    </h3>

    <p class="flex">
      <span class="font-semibold text-gray-700 mr-1">Symptoms:</span>
      <span class="text-gray-500">{{ record.symptoms }}</span>
    </p>

    <p class="flex">
      <span class="font-semibold text-gray-700 mr-1">Diagnosis:</span>
      <span class="text-gray-500">{{ record.diagnosis }}</span>
    </p>

    <p class="flex">
      <span class="font-semibold text-gray-700 mr-1">Medication:</span>
      <span class="text-gray-500">{{ record.medication }}</span>
    </p>

    <p class="text-gray-400 text-sm mt-2">
      <span class="font-semibold text-gray-700 mr-1">Date:</span>
      <span>{{ record.created_at | date : 'mediumDate' }}</span>
    </p>
  </div>

  <!-- Pagination Controls -->
  <div *ngIf="pagedRecords.length > 0" class="flex justify-center mt-4 space-x-2">
    <button
      (click)="goToPage(currentPage - 1)"
      [disabled]="currentPage === 1"
      class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50"
    >
      Prev
    </button>

    <button
      *ngFor="let page of [].constructor(totalPages); let idx = index"
      (click)="goToPage(idx + 1)"
      [ngClass]="
        currentPage === idx + 1
          ? 'bg-blue-600 text-white'
          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
      "
      class="px-3 py-1 rounded-lg"
    >
      {{ idx + 1 }}
    </button>

    <button
      (click)="goToPage(currentPage + 1)"
      [disabled]="currentPage === totalPages"
      class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50"
    >
      Next
    </button>
  </div>
</div>


<!-- Appointments Tab -->
<div *ngIf="activeTab === 'appointments'" class="space-y-4">

  <!-- No Appointments Message -->
  <div *ngIf="pagedAppointments.length === 0"
       class="text-center py-10 text-gray-500 font-semibold text-lg opacity-0 animate-fade-in">
    No appointments found.
  </div>

  <!-- Appointments List -->
  <div
    *ngFor="let app of pagedAppointments; let i = index"
    class="bg-white/90 backdrop-blur-xl rounded-3xl shadow-lg p-6 transform transition-all duration-500 hover:-translate-y-2 hover:shadow-2xl opacity-0 animate-fade-in"
    [style.animationDelay]="i * 100 + 'ms'">

    <p class="flex">
      <span class="font-semibold text-gray-700 mr-1">Doctor:</span>
      <span class="text-gray-500">{{ app.doctor_name }}</span>
    </p>

    <p class="flex">
      <span class="font-semibold text-gray-700 mr-1">Specialty:</span>
      <span class="text-gray-500">{{ app.specialty.name }}</span>
    </p>

    <p class="flex">
      <span class="font-semibold text-gray-700 mr-1">Status:</span>
      <span class="text-gray-500">{{ app.status }}</span>
    </p>

    <p class="text-gray-400 text-sm mt-2">
      <span class="font-semibold text-gray-700 mr-1">Date:</span>
      <span>{{ app.date || 'TBD' }}</span>
    </p>
  </div>

  <!-- Pagination Controls -->
  <div *ngIf="pagedAppointments.length > 0" class="flex justify-center mt-4 space-x-2">
    <button
      (click)="goToAppPage(currentAppPage - 1)"
      [disabled]="currentAppPage === 1"
      class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50">
      Prev
    </button>

    <button
      *ngFor="let page of [].constructor(totalAppPages); let idx = index"
      (click)="goToAppPage(idx + 1)"
      [ngClass]="
        currentAppPage === idx + 1
          ? 'bg-blue-600 text-white'
          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
      "
      class="px-3 py-1 rounded-lg">
      {{ idx + 1 }}
    </button>

    <button
      (click)="goToAppPage(currentAppPage + 1)"
      [disabled]="currentAppPage === totalAppPages"
      class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50">
      Next
    </button>
  </div>

</div>


    <!-- Edit Modal -->
    <div
      *ngIf="showModal"
      class="fixed inset-0 bg-black/30 flex items-center justify-center z-50 transition-opacity duration-300"
    >
      <div
        class="bg-white rounded-3xl shadow-xl w-full max-w-xl p-6 space-y-4 relative transform transition-all duration-300 scale-95 opacity-0"
        [ngClass]="{ 'scale-100 opacity-100': showModal }"
      >
        <button
          class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
          (click)="closeModal()"
        >
          âœ•
        </button>
        <h2 class="text-2xl font-bold">Edit Profile</h2>
        <form #editForm="ngForm" (ngSubmit)="saveChanges(editForm)" class="space-y-4">
          <!-- Name -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Name</label>
            <input
              [(ngModel)]="editUser.name"
              name="name"
              required
              minlength="3"
              #nameCtrl="ngModel"
              class="border rounded-lg p-2 w-full"
            />

            <!-- Errors -->
            <p class="text-red-500 text-sm" *ngIf="nameCtrl.invalid && nameCtrl.touched">
              {{ getNameError(nameCtrl) }}
            </p>
          </div>

          <!-- Email -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Email</label>
            <input
              [(ngModel)]="editUser.email"
              name="email"
              type="email"
              required
              email
              #emailCtrl="ngModel"
              class="border rounded-lg p-2 w-full"
            />

            <p class="text-red-500 text-sm" *ngIf="emailCtrl.invalid && emailCtrl.touched">
              {{ getEmailError(emailCtrl) }}
            </p>
          </div>

          <!-- Phone -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Phone</label>
            <input
              [(ngModel)]="editUser.phone"
              name="phone"
              required
              pattern="^[0-9]{10,15}$"
              #phoneCtrl="ngModel"
              class="border rounded-lg p-2 w-full"
            />

            <p class="text-red-500 text-sm" *ngIf="phoneCtrl.invalid && phoneCtrl.touched">
              {{ getPhoneError(phoneCtrl) }}
            </p>
          </div>

          <!-- Profile Image -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Profile Image</label>
            <input type="file" (change)="onImageSelected($event)" class="border rounded-lg p-2" />
            <div *ngIf="editUser.profile_pic; instanceof: File">
              <div *ngIf="imagePreview">
                <img [src]="imagePreview" class="w-32 h-32 object-cover rounded-lg mt-2" />
              </div>
            </div>
          </div>

          <!-- Blood Type -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Blood Type</label>

            <select
              [(ngModel)]="editPatient.blood_type"
              name="blood_type"
              required
              #bloodCtrl="ngModel"
              class="border rounded-lg p-2 w-full"
            >
              <option value="" disabled selected>Select Blood Type</option>

              <option value="A+">A+</option>
              <option value="A-">A-</option>

              <option value="B+">B+</option>
              <option value="B-">B-</option>

              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>

              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>

            <p class="text-red-500 text-sm" *ngIf="bloodCtrl.invalid && bloodCtrl.touched">
              {{ getBloodError(bloodCtrl) }}
            </p>
          </div>

          <!-- Chronic Diseases -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Chronic Diseases</label>
            <textarea
              [(ngModel)]="editPatient.chronic_diseases"
              name="chronic_diseases"
              required
              minlength="5"
              #chronicCtrl="ngModel"
              rows="3"
              class="border rounded-lg p-2 w-full"
            ></textarea>

            <p class="text-red-500 text-sm" *ngIf="chronicCtrl.invalid && chronicCtrl.touched">
              {{ getChronicError(chronicCtrl) }}
            </p>
          </div>

          <button
            type="submit"
            class="bg-blue-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-blue-700 transition"
          >
            Save
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
