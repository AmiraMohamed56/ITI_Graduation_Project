<div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 md:p-8">
  <!-- Skeleton Loader -->
  <div *ngIf="loading" class="space-y-6 animate-pulse">
    <div class="h-40 bg-gray-200 rounded-3xl"></div>
    <div class="flex flex-col md:flex-row gap-6">
      <div class="flex-1 space-y-4">
        <div class="h-10 bg-gray-200 rounded-lg w-3/4"></div>
        <div class="h-6 bg-gray-200 rounded-lg w-1/2"></div>
        <div class="h-6 bg-gray-200 rounded-lg w-1/4"></div>
      </div>
      <div class="flex-1 space-y-4">
        <div class="h-10 bg-gray-200 rounded-lg w-full"></div>
        <div class="h-6 bg-gray-200 rounded-lg w-5/6"></div>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div *ngIf="!loading" class="max-w-7xl mx-auto space-y-6">
    <!-- Tabs -->
    <div class="flex border-b-2 border-gray-200 mb-4 overflow-x-auto">
      <button
        (click)="activeTab = 'profile'"
        [ngClass]="activeTab === 'profile' ? 'border-blue-500 text-blue-600' : 'text-gray-500'"
        class="pb-2 px-4 font-semibold transition-colors whitespace-nowrap"
      >
        Profile
      </button>
      <button
        (click)="activeTab = 'history'"
        [ngClass]="activeTab === 'history' ? 'border-blue-500 text-blue-600' : 'text-gray-500'"
        class="pb-2 px-4 font-semibold transition-colors whitespace-nowrap"
      >
        Medical History
      </button>
      <button
        (click)="activeTab = 'appointments'"
        [ngClass]="activeTab === 'appointments' ? 'border-blue-500 text-blue-600' : 'text-gray-500'"
        class="pb-2 px-4 font-semibold transition-colors whitespace-nowrap"
      >
        Appointments
      </button>
    </div>

    <!-- Profile Tab -->
    <div *ngIf="activeTab === 'profile'" class="space-y-6">
      <!-- Header Card -->
      <div
        class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl p-6 flex flex-col md:flex-row items-center gap-6 transition-transform hover:-translate-y-1 duration-300"
      >
        <div class="relative">
          <div
            *ngIf="patient.profile_pic; else initials"
            class="w-36 h-36 md:w-44 md:h-44 rounded-full border-4 border-white overflow-hidden shadow-lg"
          >
            <img [src]="patient.profile_pic" class="w-full h-full object-cover" />
          </div>
          <ng-template #initials>
            <div
              class="w-36 h-36 md:w-44 md:h-44 rounded-full border-4 border-white bg-blue-400 flex items-center justify-center text-white text-4xl font-bold shadow-lg"
            >
              {{ getInitials() }}
            </div>
          </ng-template>
          <div
            class="absolute bottom-2 right-2 w-5 h-5 bg-green-500 rounded-full border-2 border-white"
          ></div>
        </div>
        <div class="flex-1 text-center md:text-left space-y-2">
          <h1
            class="text-3xl mb-4 md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600"
          >
            {{ patient.name }}
          </h1>
          <p class="text-gray-600">{{ patient.email }}</p>
          <p class="text-gray-600">{{ patient.phone }}</p>
          <p class="text-gray-600">Member since: {{ patient.member_since }}</p>
          <p class="text-gray-600" *ngIf="patient.chronic_diseases">
            Chronic Diseases: {{ patient.chronic_diseases }}
          </p>
          <p class="text-gray-600">
            Status: <span class="capitalize">{{ patient.status }}</span>
          </p>
        </div>
        <button
          (click)="openEditModal()"
          class="absolute top-4 right-4 bg-blue-600 text-white px-3 py-1 rounded-lg hover:bg-blue-700 transition"
        >
          Edit
        </button>
      </div>

      <!-- Stats -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div
          class="bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg p-4 text-center transition-transform hover:-translate-y-1 duration-300"
        >
          <p class="text-gray-500">Total Appointments</p>
          <h3 class="text-2xl font-bold text-blue-600">{{ patient.appointments_count }}</h3>
        </div>
        <div
          class="bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg p-4 text-center transition-transform hover:-translate-y-1 duration-300"
        >
          <p class="text-gray-500">Medical Records</p>
          <h3 class="text-2xl font-bold text-indigo-600">{{ patient.medical_records_count }}</h3>
        </div>
        <div
          class="bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg p-4 text-center transition-transform hover:-translate-y-1 duration-300"
        >
          <p class="text-gray-500">Blood Type</p>
          <h3 class="text-2xl font-bold text-purple-600">{{ patient.blood_type }}</h3>
        </div>
        <div
          class="bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg p-4 text-center transition-transform hover:-translate-y-1 duration-300"
          *ngIf="patient.age"
        >
          <p class="text-gray-500">Age</p>
          <h3 class="text-2xl font-bold text-green-600">{{ patient.age }}</h3>
        </div>
      </div>
    </div>

    <!-- Medical History Tab -->
    <div *ngIf="activeTab === 'history'" class="space-y-4">
      <div
        *ngFor="let record of pagedRecords; let i = index"
        class="bg-white/90 backdrop-blur-xl rounded-3xl shadow-lg p-6 transform transition-all duration-500 hover:-translate-y-2 hover:shadow-2xl opacity-0 animate-fade-in"
        [style.animationDelay]="i * 100 + 'ms'"
      >
        <h3 class="text-lg font-bold text-blue-600 mb-2">Medical Record #{{ record.id }}</h3>
        <p class="flex">
          <span class="font-semibold text-gray-700 mr-1">Symptoms:</span>
          <span class="text-gray-500">{{ record.symptoms }}</span>
        </p>

        <p class="flex">
          <span class="font-semibold text-gray-700 mr-1">Diagnosis:</span>
          <span class="text-gray-500">{{ record.diagnosis }}</span>
        </p>

        <p class="flex">
          <span class="font-semibold text-gray-700 mr-1">Medication:</span>
          <span class="text-gray-500">{{ record.medication }}</span>
        </p>

        <p class="text-gray-400 text-sm mt-2">
          <span class="font-semibold text-gray-700 mr-1">Date:</span>
          <span>{{ record.created_at | date : 'mediumDate' }}</span>
        </p>
      </div>

      <!-- Pagination Controls -->
      <div class="flex justify-center mt-4 space-x-2">
        <button
          (click)="goToPage(currentPage - 1)"
          [disabled]="currentPage === 1"
          class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50"
        >
          Prev
        </button>

        <button
          *ngFor="let page of [].constructor(totalPages); let idx = index"
          (click)="goToPage(idx + 1)"
          [ngClass]="
            currentPage === idx + 1
              ? 'bg-blue-600 text-white'
              : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
          "
          class="px-3 py-1 rounded-lg"
        >
          {{ idx + 1 }}
        </button>

        <button
          (click)="goToPage(currentPage + 1)"
          [disabled]="currentPage === totalPages"
          class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50"
        >
          Next
        </button>
      </div>
    </div>

    <!-- Appointments Tab -->
    <div *ngIf="activeTab === 'appointments'" class="space-y-4">
      <div
        *ngFor="let app of pagedAppointments; let i = index"
        class="bg-white/90 backdrop-blur-xl rounded-3xl shadow-lg p-6 transform transition-all duration-500 hover:-translate-y-2 hover:shadow-2xl opacity-0 animate-fade-in"
        [style.animationDelay]="i * 100 + 'ms'"
      >
        <p class="flex">
          <span class="font-semibold text-gray-700 mr-1">Doctor:</span>
          <span class="text-gray-500">{{ app.doctor_name }}</span>
        </p>

        <p class="flex">
          <span class="font-semibold text-gray-700 mr-1">Specialty:</span>
          <span class="text-gray-500">{{ app.specialty.name }}</span>
        </p>

        <p class="flex">
          <span class="font-semibold text-gray-700 mr-1">Status:</span>
          <span class="text-gray-500">{{ app.status }}</span>
        </p>

        <p class="text-gray-400 text-sm mt-2">
          <span class="font-semibold text-gray-700 mr-1">Date:</span>
          <span>{{ app.date || 'TBD' }}</span>
        </p>
      </div>

      <!-- Pagination Controls -->
      <div *ngIf="activeTab === 'appointments'" class="space-y-4">
        <div
          *ngFor="let app of pagedAppointments; let i = index"
          class="bg-white/90 backdrop-blur-xl rounded-3xl shadow-lg p-6 transform transition-all duration-500 hover:-translate-y-2 hover:shadow-2xl opacity-0 animate-fade-in"
          [style.animationDelay]="i * 100 + 'ms'"
        >
          <p class="flex">
            <span class="font-semibold text-gray-700 mr-1">Doctor:</span>
            <span class="text-gray-500">{{ app.doctor_name }}</span>
          </p>

          <p class="flex">
            <span class="font-semibold text-gray-700 mr-1">Specialty:</span>
            <span class="text-gray-500">{{ app.specialty.name }}</span>
          </p>

          <p class="flex">
            <span class="font-semibold text-gray-700 mr-1">Status:</span>
            <span class="text-gray-500">{{ app.status }}</span>
          </p>

          <p class="text-gray-400 text-sm mt-2">
            <span class="font-semibold text-gray-700 mr-1">Date:</span>
            <span>{{ app.date || 'TBD' }}</span>
          </p>
        </div>

        <!-- Pagination Controls -->
        <div class="flex justify-center mt-4 space-x-2">
          <button
            (click)="goToAppPage(currentAppPage - 1)"
            [disabled]="currentAppPage === 1"
            class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50"
          >
            Prev
          </button>

          <button
            *ngFor="let page of [].constructor(totalAppPages); let idx = index"
            (click)="goToAppPage(idx + 1)"
            [ngClass]="
              currentAppPage === idx + 1
                ? 'bg-blue-600 text-white'
                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
            "
            class="px-3 py-1 rounded-lg"
          >
            {{ idx + 1 }}
          </button>

          <button
            (click)="goToAppPage(currentAppPage + 1)"
            [disabled]="currentAppPage === totalAppPages"
            class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50"
          >
            Next
          </button>
        </div>
      </div>
    </div>
    <!-- Edit Modal -->
    <div
      *ngIf="showModal"
      class="fixed inset-0 bg-black/30 flex items-center justify-center z-50 transition-opacity duration-300"
    >
      <div
        class="bg-white rounded-3xl shadow-xl w-full max-w-xl p-6 space-y-4 relative transform transition-all duration-300 scale-95 opacity-0"
        [ngClass]="{ 'scale-100 opacity-100': showModal }"
      >
        <button
          class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
          (click)="closeModal()"
        >
          âœ•
        </button>
        <h2 class="text-2xl font-bold">Edit Profile</h2>
        <form (ngSubmit)="saveChanges()" class="space-y-4">
          <!-- Name -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Name</label>
            <input [(ngModel)]="editUser.name" name="name" class="border rounded-lg p-2 w-full" />
          </div>

          <!-- Email -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Email</label>
            <input
              [(ngModel)]="editUser.email"
              name="email"
              type="email"
              class="border rounded-lg p-2 w-full"
            />
          </div>

          <!-- Phone -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Phone</label>
            <input
              [(ngModel)]="editUser.phone"
              name="phone"
              type="text"
              class="border rounded-lg p-2 w-full"
            />
          </div>

          <!-- Profile Image -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Profile Image</label>
            <input type="file" (change)="onImageSelected($event)" class="border rounded-lg p-2" />
            <div *ngIf="editUser.profile_pic; instanceof: File">
              <div *ngIf="imagePreview">
                <img [src]="imagePreview" class="w-32 h-32 object-cover rounded-lg mt-2" />
              </div>
            </div>
          </div>

          <!-- Blood Type -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Blood Type</label>
            <input
              [(ngModel)]="editPatient.blood_type"
              name="blood_type"
              type="text"
              class="border rounded-lg p-2 w-full"
            />
          </div>

          <!-- Chronic Diseases -->
          <div class="flex flex-col gap-2">
            <label class="font-semibold">Chronic Diseases</label>
            <textarea
              [(ngModel)]="editPatient.chronic_diseases"
              name="chronic_diseases"
              rows="3"
              class="border rounded-lg p-2 w-full"
            ></textarea>
          </div>

          <button
            type="submit"
            class="bg-blue-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-blue-700 transition"
          >
            Save
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
